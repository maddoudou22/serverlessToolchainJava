
Dans CodeBuild, spécifier 'privilege' lors du choix de l'image utiliée pour la compilation sinon on ne peut pas lancer Docker
Ne pas cocher la case spécifiant que CodeBuild peut modifier la policy qu'il utilise

Le role et la policy que CodeBuild utilise doit être :


{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Resource": [
                "arn:aws:logs:eu-west-1:962109799108:log-group:/aws/codebuild/serverlessToolchainJava-build",
                "arn:aws:logs:eu-west-1:962109799108:log-group:/aws/codebuild/serverlessToolchainJava-build:*"
            ],
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents"
            ]
        },
        {
            "Effect": "Allow",
            "Resource": [
                "arn:aws:s3:::serverlesstoolchainjava*"
            ],
            "Action": [
                "s3:PutObject",
                "s3:GetObject",
                "s3:GetObjectVersion"
            ]
        },
        {
            "Action": [
                "ecr:BatchCheckLayerAvailability",
                "ecr:CompleteLayerUpload",
                "ecr:GetAuthorizationToken",
                "ecr:InitiateLayerUpload",
                "ecr:PutImage",
                "ecr:UploadLayerPart"
            ],
            "Resource": "*",
            "Effect": "Allow"
        }
    ]
}





S'aider du modop suivant :
https://docs.aws.amazon.com/codebuild/latest/userguide/sample-docker.html

Dans CodeBuild, spéficier les variables d'environnement suivantes :
	AWS_DEFAULT_REGION
	AWS_ACCOUNT_ID
	IMAGE_REPO_NAME
	IMAGE_TAG
	key-ID



